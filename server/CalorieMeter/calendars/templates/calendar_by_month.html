{% extends "base.html" %}
{% block content %}
<style>
    /* FullCalendarのカスタムスタイリング */
    #calendar {
        font-family: 'Inter', system-ui, -apple-system, sans-serif;
    }
    
    .fc {
        border-radius: 0.75rem;
        overflow: hidden;
    }
    
    .fc-toolbar-title {
        font-size: 1.75rem !important;
        font-weight: 700 !important;
        color: #1f2937;
    }
    
    .fc-toolbar {
        display: flex !important;
        align-items: center !important;
        justify-content: space-between !important;
        flex-wrap: nowrap !important;
    }
    
    .fc-toolbar-chunk {
        display: flex !important;
        align-items: center !important;
        gap: 0.5rem !important;
        flex-direction: row !important;
    }
    
    .fc-toolbar-chunk > * {
        display: inline-flex !important;
        align-items: center !important;
    }
    
    .fc-button-group {
        display: inline-flex !important;
        align-items: center !important;
        gap: 0.5rem !important;
    }
    
    .fc-button {
        background-color: #3b82f6 !important;
        border: none !important;
        border-radius: 0.5rem !important;
        padding: 0.5rem 1rem !important;
        font-weight: 500 !important;
        transition: all 0.2s !important;
    }
    
    {% comment %} .fc-button:hover {
        background-color: #2563eb !important;
        transform: translateY(-1px);
    } {% endcomment %}
    
    {% comment %} .fc-button:active {
        background-color: #1d4ed8 !important;
    } {% endcomment %}
    
    .fc-button-primary:disabled {
        background-color: #9ca3af !important;
        opacity: 0.6;
    }
    
    .fc-col-header-cell {
        background-color: #f3f4f6 !important;
        font-weight: 600 !important;
        color: #4b5563 !important;
        padding: 1rem 0.5rem !important;
        border-color: #e5e7eb !important;
    }
    
    .fc-daygrid-day {
        transition: background-color 0.2s;
    }
    
    .fc-daygrid-day:hover {
        background-color: #f9fafb;
    }
    
    .fc-daygrid-day-number {
        color: #374151 !important;
        font-weight: 500 !important;
        padding: 0.5rem !important;
    }
    
    .fc-day-today {
        background-color: #dbeafe !important;
    }
    
    .fc-day-today .fc-daygrid-day-number {
        color: #1e40af !important;
        font-weight: 700 !important;
    }
    
    .fc-event {
        border-radius: 0.375rem !important;
        border: none !important;
        padding: 0.25rem 0.5rem !important;
        font-weight: 500 !important;
        background-color: transparent !important;
        cursor:pointer !important;
    }
    
    .fc-daygrid-event {
        margin: 2px 4px !important;
    }
    
    .fc-scrollgrid {
        border-color: #e5e7eb !important;
        border-radius: 0.75rem;
    }
    
    .fc-scrollgrid td, .fc-scrollgrid th {
        border-color: #e5e7eb !important;
    }
    
    /* カスタムイベント画像スタイル - 大きな画像のみ表示 */
    .fc-event .event-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 0.375rem;
    }
    
    .fc-event .event-content {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100%;
        height: 100%;
        padding: 0;
    }
    
    .fc-event .event-text {
        display: none;
    }
</style>

<!-- グラデーション背景とコンテナ -->
<div class="py-8 px-4">
    {{ data|json_script:"data-json" }}
    <div class="max-w-7xl mx-auto">
        <!-- ヘッダーセクション -->
        <div class="mb-8 text-center">
            {% comment %} <h1 class="text-4xl font-bold text-gray-800 mb-2 flex items-center justify-start gap-3">
                <i data-lucide="calendar-days" class="w-10 h-10"></i>
                カレンダー
            </h1> {% endcomment %}
        </div>
        
        <!-- カレンダーコンテナ -->
        <div class="p-6 md:p-8 card">
            <div id='calendar'></div>
        </div>
    </div>
</div>

<script>
    lucide.createIcons();
</script>
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.19/index.global.min.js'></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const data = JSON.parse(document.getElementById('data-json').textContent);
    const meals = data.meals;
    
    // FullCalendarのイベント形式に変換
    const events = meals.map(meal => ({
      id: meal.id,
      title: meal.title,
      start: meal.date,
      imageUrl: meal.imageUrl,
      calories: meal.calories,
      description: meal.description
    }));
    
    const calendarEl = document.getElementById('calendar');
    const calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      locale: 'ja',
      headerToolbar: {
        left: 'today',
        center: '',
        right: 'prev,title,next'
      },
      buttonText: {
        today: '今日',
      },
      height: 'auto',
      events: events,
      eventContent: function(arg) {
        // 画像URLが設定されている場合のカスタムレンダリング - 画像のみ表示
        if (arg.event.extendedProps.imageUrl) {
          return {
            html: `
              <div class="event-content">
                <img src="${arg.event.extendedProps.imageUrl}" 
                     alt="${arg.event.title}" 
                     class="event-image">
              </div>
            `
          };
        }
        // 画像がない場合は通常のテキスト表示
        return { html: `<span class="event-text">${arg.event.title}</span>` };
      },
      eventClick: function(info) {
        alert('something happens');
      }
    });
    calendar.render();
  });
</script>
{% endblock %}